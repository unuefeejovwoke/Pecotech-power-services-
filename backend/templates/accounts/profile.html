{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon" />

    <title>Pecotech | Dashboard</title>
    <!-- Primary Meta Tags -->
    <meta name="title" content="Pecotech Power Services" />
    <meta name="description" content="Discover top-tier electrical services with Pecotech. Our experts specialize in residential and commercial solutions, ensuring safety, efficiency, and reliability. Contact us today for all your electrical needs." />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pecotech.netlify.app/" />
    <meta property="og:title" content="Pecotech Power Services" />
    <meta property="og:description" content="Discover top-tier electrical services with Pecotech. Our experts specialize in residential and commercial solutions, ensuring safety, efficiency, and reliability. Contact us today for all your electrical needs." />
    <meta property="og:image" content="./assets/img/flogo.webp" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://pecotech.netlify.app/" />
    <meta property="twitter:title" content="Pecotech Power Services" />
    <meta property="twitter:description" content="Discover top-tier electrical services with Pecotech. Our experts specialize in residential and commercial solutions, ensuring safety, efficiency, and reliability. Contact us today for all your electrical needs." />
    <meta property="twitter:image" content="./assets/img/flogo.webp" />

    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static './assets/vendor/all.min.css' %}" />
  </head>
  <body class="font-[Montserrat]">
    <!-- TOP BANNER -->
    {% include 'components/navbar.html' %}
    <!-- ############## END OF NAV ############## -->

    <!-- ########## BANNER ########## -->
    <div class="bg-breadcrum">
      
      <section class="text-white backdrop-brightness-50 h-full py-[58px] lg:py-[85px]">
        <div class="pad">
          <h1 class="text-xl md:text-3xl lg:text-6xl mt-2 font-extrabold text-primary">
            <span class="border-b-4 border-b-primary text-white">{{ 'now'|time_based_greeting }}</span>
            {{ user.first_name|capfirst }}
          </h1>
        </div>
      </section>
    </div>
    <!-- ########## END OF BANNER ########## -->

    <!-- ############ MAIN ########### -->
    <section class="bg-grey">
      {% include "alerts/alert.html" %}
      <div class="pad flex flex-col lg:flex-row-reverse items-center gap-4 lg:items-start">
        <div class="bg-white max-w-[350px] md:max-w-[800px] mx-auto flex flex-col md:flex-row lg:max-w-[350px] lg:flex-col">
          {% if profile_picture %}
            <img src="{{ profile_picture.url }}" alt="{{ user.username }}'s Profile Picture" />
          {% else %}
            <!-- Display a default profile picture if the user doesn't have one -->
            <img src="{% static 'path_to_default_profile_picture.png' %}" alt="Default Profile Picture" />
          {% endif %}

          <div class="p-6 text-lg flex justify-center flex-col md:w-[50%] lg:w-full">
            <div class="flex flex-col items-center mb-6">
              <h1 class="font-bold text-2xl">{{ user.username|capfirst }}</h1>
              <p>{{ user.email }}</p>
              <a href="{% url 'edit_profile' %}" class="text-primary flex gap-2 items-center">
                <i class="fa-solid fa-edit"></i>
                <p>Edit Profile</p>
              </a>
            </div>
            <ul>
              <li>30 Projects Completed</li>
              <li>8 Projects in Progress</li>
              <li>2 Projects in Review</li>
            </ul>
            <div style="text-align: center; color: #ffaf1d;">
              <a href="{% url 'logout' %}">Logout</a>
            </div>
          </div>
        </div>

        <!-- ###### TABS ######### -->
        <div class="w-full">
          <div class="mt-8 lg:mt-0 bg-white">
            <div class="flex text-white gap-1 text-xs sm:text-sm md:text-md">
              <span class="p-2 w-1/4 text-center bg-grey hover:bg-grey cursor-pointer tab-button">Recent Updates</span>
              <span class="p-2 w-1/4 text-center bg-primary hover:bg-grey cursor-pointer tab-button">Service Request</span>
              <span class="p-2 w-1/4 text-center bg-primary hover:bg-grey cursor-pointer tab-button">Projects</span>
              <span class="p-2 w-1/4 text-center bg-primary hover:bg-grey cursor-pointer tab-button">Other Services</span>
            </div>
            <div class="p-4 bg-white rounded-b">
              <div class="tab-content">
                <!-- ######### TAB ONE ########3 -->
                <div class="tab-pane">
                  {% if recent_updates %}
                    {% for recent_project in recent_updates %}
                      <span class="flex items-center py-4 border-black border-b-2 gap-4">
                        <i class="fa-solid fa-arrow-right hidden md:flex"></i>
                        {{ recent_project.description }}
                      </span>
                    {% endfor %}
                  {% else %}
                    <p>No Recent Projects</p>
                  {% endif %}
                </div>
                <!-- ########## TAB TWO ########## -->
                <div class="tab-pane hidden">
                  {% for request in service_requests %}
                  <span class="shadow-md flex items-center mb-4">
                    <img class="w-1/3 hidden md:flex" src="{{ request.uploaded_files.url }}" alt="service request"/>
                    <div class="md:w-2/3 p-4">
                      <h1 class="font-semibold text-lg">{{ request.service_required|capfirst|upper }}</h1>
                      <p class="my-2">Quotation for {{ request.service_required|capfirst }} installation made on {{ request.submission_date|date:"d/m/Y" }}</p>
                      <p class="font-semibold">Status: <span style="color: {% if request.status|lower == 'delivered' %}green{% else %}{{ request.status|lower }}{% endif %}">{{ request.status }}</span> </p>

                    </div>
                  </span>
                {% empty %}
                  <p>No service requests found.</p>
                {% endfor %}
                 
                  <div class="text-center mt-7">
                    <p>No more requests.</p>
                  </div>
                </div>
                <!-- ########### TAB THREE #### -->

                <div class="tab-pane hidden">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mx-auto">
                    {% for project in user_projects %}
                    <div class="shadow-md rounded-lg overflow-hidden max-w-[300px] mx-auto">
                      <img src="{{ project.image.url }}" alt="solar installation" />
                      <div class="p-4">
                        <div class="text-center mb-3">
                          <h1 class="font-semibold text-lg">{{project.title}}</h1>
                          <p>{{project.location}}</p>
                        </div>
                        <p>Start Date: <span style="font-size: 14px; font-weight: bold;">{{project.start_date}}</span> </p>
                        <p>Finish Date: <span style="font-size: 14px; font-weight: bold;">{{project.finish_date}}</span> </p>
                        <p class="font-semibold">
                          Status: <span class="text-green-500">{{project.get_status_display}}</span>
                        </p>
                      </div>
                    </div>
                    {% endfor %}
                    
                  </div>
                  <div class="text-center mt-7">
                    <p>No more Projects.</p>
                  </div>
                </div>
                <!-- ########### TAB FOUR ####### -->
                <div class="tab-pane hidden">
                  <div class="bg-electbg rounded-lg overflow-hidden">
                    <div class="backdrop-brightness-50 text-white p-5">
                      <span class="flex gap-5 items-center">
                        <div class="bg-primary/50 w-10 h-10 flex items-center justify-center rounded-full">1</div>
                        <h1 class="font-semibold text-lg">Electrical Wiring</h1>
                      </span>
                      <p class="my-5 md:ml-[59px]">With pecotech, you know you will get exactly what we promised. We always deliver on our promises! We always deliver on our promises!</p>
                      <p class="text-primary cursor-pointer md:ml-[59px] serviceFormBtn">REQUEST SERVICE</p>
                    </div>
                  </div>
                  <div class="bg-homeautobg rounded-lg my-4 overflow-hidden">
                    <div class="backdrop-brightness-50 text-white p-5">
                      <span class="flex gap-5 items-center">
                        <div class="bg-primary/50 w-10 h-10 flex items-center justify-center rounded-full">2</div>
                        <h1 class="font-semibold text-lg">Home Automation</h1>
                      </span>
                      <p class="my-5 md:ml-[59px]">With pecotech, you know you will get exactly what we promised. We always deliver on our promises! We always deliver on our promises!</p>
                      <p class="text-primary cursor-pointer md:ml-[59px] serviceFormBtn">REQUEST SERVICE</p>
                    </div>
                  </div>
                  <div class="bg-cctvbg rounded-lg my-4 overflow-hidden">
                    <div class="backdrop-brightness-50 text-white p-5">
                      <span class="flex gap-5 items-center">
                        <div class="bg-primary/50 w-10 h-10 flex items-center justify-center rounded-full">3</div>
                        <h1 class="font-semibold text-lg">CCTV Installation</h1>
                      </span>
                      <p class="my-5 md:ml-[59px]">With pecotech, you know you will get exactly what we promised. We always deliver on our promises! We always deliver on our promises!</p>
                      <p class="text-primary cursor-pointer md:ml-[59px] serviceFormBtn">REQUEST SERVICE</p>
                    </div>
                  </div>
                  <div class="bg-solarbg rounded-lg overflow-hidden">
                    <div class="backdrop-brightness-50 text-white p-5">
                      <span class="flex gap-5 items-center">
                        <div class="bg-primary/50 w-10 h-10 flex items-center justify-center rounded-full">4</div>
                        <h1 class="font-semibold text-lg">Solar Installation</h1>
                      </span>
                      <p class="my-5 md:ml-[59px]">With pecotech, you know you will get exactly what we promised. We always deliver on our promises! We always deliver on our promises!</p>
                      <p class="text-primary cursor-pointer md:ml-[59px] serviceFormBtn">REQUEST SERVICE</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- ############ END OF MAIN ########### -->
    <section></section>
    <section></section>

    <!-- ############## SERVICE request form ############### -->
    <div id="serviceForm" class="w-screen h-screen fixed flex hidden items-center justify-center top-0 backdrop-brightness-50 z-40 text-sm">
      <div class="p-5 relative bg-white max-w-[420px] m-3 rounded-lg">
        <span class="absolute cursor-pointer right-4 text-xl serviceFormBtn"><i class="fa-solid fa-times"></i></span>
        <div class="flex justify-center">
          <img class="w-24" src="{% static './assets/img/flogo.webp' %}" alt="logo" />
        </div>
        <div class="w-full bg-primary bg-opacity-30 rounded-lg mb-4 text-center p-3 text-xs">
          <h1 class="font-bold text-lg">Service Request Form</h1>
          <p>Please fill out this form & a member of our team will be in touch shortly.</p>
        </div>
        <form method="post" enctype="multipart/form-data" class="w-full" id="service-request-form" onsubmit="submitForm(event);">
          {% csrf_token %}
          {{ form.full_name.label_tag }}
          {{ form.full_name }}
          {{ form.email.label_tag }}
          {{ form.email }}
          {{ form.phone_number.label_tag }}
          {{ form.phone_number }}
          <span class="flex justify-between relative mb-2">
            <p class="font-semibold">Send Quotation</p>
            <span id="srf-info-btn"><i class="fa-regular fa-circle-question text-primary"></i></span>
            <div class="absolute bg-primary p-3 rounded-lg top-5 hidden" id="srf-info">
              <h2 class="font-semibold">Send Quotation</h2>
              <p>Have a building drawing you want us to wire, or an estimate you want us to work with, or a sample (CCTV camera, solar panel, etc) of what you require us to install for you? send it via image or PDF</p>
            </div>
          </span>
          {{ form.uploaded_files.label_tag }}
          {{ form.uploaded_files }}
          <p class="text-primary my-2 font-semibold">What service do you require?</p>
          <span class="flex justify-between">
            <label for="{{ form.service_required.id_for_label }}">
              <input type="radio" id="{{ form.service_required.id_for_label }}" name="{{ form.service_required.name }}" value="cctv" {% if form.service_required.value == "cctv" %}checked{% endif %}>
              CCTV Installation
            </label>
            <label for="{{ form.service_required.id_for_label }}">
              <input type="radio" id="{{ form.service_required.id_for_label }}" name="{{ form.service_required.name }}" value="solar" {% if form.service_required.value == "solar" %}checked{% endif %}>
              Solar Installation
            </label>
          </span>
          <span class="flex justify-between my-2">
            <label for="{{ form.service_required.id_for_label }}">
              <input type="radio" id="{{ form.service_required.id_for_label }}" name="{{ form.service_required.name }}" value="home" {% if form.service_required.value == "home" %}checked{% endif %}>
              Home Automation
            </label>
            <label for="{{ form.service_required.id_for_label }}">
              <input type="radio" id="{{ form.service_required.id_for_label }}" name="{{ form.service_required.name }}" value="electrical" {% if form.service_required.value == "electrical" %}checked{% endif %}>
              Electrical Wiring
            </label>
          </span>
        
          <!-- Disable the button and display "Sending" message -->
          <button id="submit-button" style="background-color: #ffaf1d;" class="w-full" type="submit">Submit Request</button>
        </form>

        
      </div>
    </div>
    <!-- ############## END OF service request form ############### -->

    <!-- ############## FOOTER ################ -->
    {% include 'components/footer.html' %}
    <script>
      function submitForm(event) {
        event.preventDefault(); // Prevent the default form submission behavior
    
        // Show "Sending" message
        const submitButton = document.querySelector('#submit-button');
        submitButton.innerHTML = 'Sending Please Wait!...';
        submitButton.style.backgroundColor = '#454a4a'; // Change the background color
        submitButton.disabled = true;
    
        // Submit the form
        const form = document.querySelector('#service-request-form');
        form.submit();
      }
    </script>
  </body>

  <script src="{% static './assets/vendor/all.min.js' %}"></script>
  <script src="{% static './assets/scripts/app.js' %}"></script>
</html>
